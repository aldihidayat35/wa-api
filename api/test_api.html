<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Endpoints</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
        }
        
        .test-card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .test-card p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .result-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            border-left: 4px solid #667eea;
        }
        
        .result-box pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #333;
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-loading {
            background: #fff3cd;
            color: #856404;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .badge-get { background: #d1ecf1; color: #0c5460; }
        .badge-post { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ API Endpoint Tester</h1>
        
        <div class="test-grid">
            <!-- Test 1: Get All Logs -->
            <div class="test-card">
                <h2>üìã Get All Logs <span class="badge badge-get">GET</span></h2>
                <p>Retrieve all activity logs from database</p>
                
                <div class="input-group">
                    <label>Limit:</label>
                    <input type="number" id="get-limit" value="10" min="1" max="500">
                </div>
                
                <button class="btn btn-info" onclick="testGetLogs()">Test GET Logs</button>
                <div id="result-get-logs" class="result-box" style="display: none;">
                    <pre></pre>
                </div>
            </div>
            
            <!-- Test 2: Create Log -->
            <div class="test-card">
                <h2>‚ûï Create Log <span class="badge badge-post">POST</span></h2>
                <p>Create a new activity log entry</p>
                
                <div class="input-group">
                    <label>Log Type:</label>
                    <select id="create-type">
                        <option value="message">Message</option>
                        <option value="session">Session</option>
                        <option value="error">Error</option>
                        <option value="system">System</option>
                        <option value="api">API</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Title:</label>
                    <input type="text" id="create-title" value="Test Log Entry">
                </div>
                
                <div class="input-group">
                    <label>Description:</label>
                    <textarea id="create-description" rows="3">This is a test log entry created from API tester</textarea>
                </div>
                
                <button class="btn btn-success" onclick="testCreateLog()">Create Log</button>
                <div id="result-create-log" class="result-box" style="display: none;">
                    <pre></pre>
                </div>
            </div>
            
            <!-- Test 3: Get Statistics -->
            <div class="test-card">
                <h2>üìä Get Statistics <span class="badge badge-get">GET</span></h2>
                <p>Retrieve activity statistics</p>
                
                <div class="input-group">
                    <label>Period:</label>
                    <select id="stats-period">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="all">All Time</option>
                    </select>
                </div>
                
                <button class="btn btn-info" onclick="testGetStats()">Get Statistics</button>
                <div id="result-stats" class="result-box" style="display: none;">
                    <pre></pre>
                </div>
            </div>
            
            <!-- Test 4: Filter Logs -->
            <div class="test-card">
                <h2>üîç Filter Logs <span class="badge badge-get">GET</span></h2>
                <p>Filter logs by type and search</p>
                
                <div class="input-group">
                    <label>Log Type:</label>
                    <select id="filter-type">
                        <option value="all">All</option>
                        <option value="message">Message</option>
                        <option value="session">Session</option>
                        <option value="error">Error</option>
                        <option value="system">System</option>
                        <option value="api">API</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Search:</label>
                    <input type="text" id="filter-search" placeholder="Search in title/description">
                </div>
                
                <button class="btn btn-info" onclick="testFilterLogs()">Filter Logs</button>
                <div id="result-filter" class="result-box" style="display: none;">
                    <pre></pre>
                </div>
            </div>
            
            <!-- Test 5: Export Logs -->
            <div class="test-card">
                <h2>üì• Export Logs <span class="badge badge-get">GET</span></h2>
                <p>Export logs to CSV or JSON format</p>
                
                <div class="input-group">
                    <label>Format:</label>
                    <select id="export-format">
                        <option value="csv">CSV</option>
                        <option value="json">JSON</option>
                    </select>
                </div>
                
                <button class="btn btn-success" onclick="testExportLogs()">Export Logs</button>
                <p id="export-status" style="margin-top: 15px; color: #666; font-size: 14px;"></p>
            </div>
            
            <!-- Test 6: Clear Logs -->
            <div class="test-card">
                <h2>üóëÔ∏è Clear Logs <span class="badge badge-post">POST</span></h2>
                <p>Delete old or all activity logs</p>
                
                <div class="input-group">
                    <label>Action:</label>
                    <select id="clear-action">
                        <option value="old">Delete Old (90 days)</option>
                        <option value="by_type">Delete by Type</option>
                        <option value="all">Delete All (‚ö†Ô∏è Dangerous)</option>
                    </select>
                </div>
                
                <div class="input-group" id="clear-type-group" style="display: none;">
                    <label>Log Type to Delete:</label>
                    <select id="clear-type">
                        <option value="message">Message</option>
                        <option value="session">Session</option>
                        <option value="error">Error</option>
                        <option value="system">System</option>
                        <option value="api">API</option>
                    </select>
                </div>
                
                <button class="btn btn-danger" onclick="testClearLogs()">‚ö†Ô∏è Clear Logs</button>
                <div id="result-clear" class="result-box" style="display: none;">
                    <pre></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '../api/logs/';
        
        // Show/hide type selection for clear action
        document.getElementById('clear-action').addEventListener('change', function() {
            const typeGroup = document.getElementById('clear-type-group');
            typeGroup.style.display = this.value === 'by_type' ? 'block' : 'none';
        });
        
        // Helper function to display results
        function displayResult(elementId, data, status = 'success') {
            const resultBox = document.getElementById(elementId);
            const pre = resultBox.querySelector('pre');
            
            if (typeof data === 'object') {
                pre.textContent = JSON.stringify(data, null, 2);
            } else {
                pre.textContent = data;
            }
            
            resultBox.style.display = 'block';
            resultBox.style.borderLeftColor = status === 'success' ? '#28a745' : '#dc3545';
        }
        
        // Test 1: Get All Logs
        async function testGetLogs() {
            const limit = document.getElementById('get-limit').value;
            
            try {
                const response = await fetch(`${API_BASE}get.php?log_type=all&limit=${limit}&offset=0`);
                const data = await response.json();
                displayResult('result-get-logs', data, data.success ? 'success' : 'error');
            } catch (error) {
                displayResult('result-get-logs', { error: error.message }, 'error');
            }
        }
        
        // Test 2: Create Log
        async function testCreateLog() {
            const logData = {
                log_type: document.getElementById('create-type').value,
                title: document.getElementById('create-title').value,
                description: document.getElementById('create-description').value,
                session_id: 'test_session',
                metadata: {
                    source: 'API Tester',
                    timestamp: new Date().toISOString()
                }
            };
            
            try {
                const response = await fetch(`${API_BASE}create.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(logData)
                });
                
                const data = await response.json();
                displayResult('result-create-log', data, data.success ? 'success' : 'error');
            } catch (error) {
                displayResult('result-create-log', { error: error.message }, 'error');
            }
        }
        
        // Test 3: Get Statistics
        async function testGetStats() {
            const period = document.getElementById('stats-period').value;
            
            try {
                const response = await fetch(`${API_BASE}stats.php?period=${period}`);
                const data = await response.json();
                displayResult('result-stats', data, data.success ? 'success' : 'error');
            } catch (error) {
                displayResult('result-stats', { error: error.message }, 'error');
            }
        }
        
        // Test 4: Filter Logs
        async function testFilterLogs() {
            const type = document.getElementById('filter-type').value;
            const search = document.getElementById('filter-search').value;
            
            let url = `${API_BASE}get.php?log_type=${type}&limit=20`;
            if (search) {
                url += `&search=${encodeURIComponent(search)}`;
            }
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                displayResult('result-filter', data, data.success ? 'success' : 'error');
            } catch (error) {
                displayResult('result-filter', { error: error.message }, 'error');
            }
        }
        
        // Test 5: Export Logs
        function testExportLogs() {
            const format = document.getElementById('export-format').value;
            const url = `${API_BASE}export.php?format=${format}&log_type=all`;
            
            document.getElementById('export-status').textContent = `Opening export URL: ${url}`;
            
            // Open in new window to trigger download
            window.open(url, '_blank');
            
            setTimeout(() => {
                document.getElementById('export-status').textContent = `Export initiated! Check your downloads folder for the ${format.toUpperCase()} file.`;
            }, 1000);
        }
        
        // Test 6: Clear Logs
        async function testClearLogs() {
            const action = document.getElementById('clear-action').value;
            
            if (action === 'all' && !confirm('‚ö†Ô∏è WARNING: This will delete ALL logs!\n\nAre you absolutely sure?')) {
                return;
            }
            
            const requestData = { action };
            
            if (action === 'by_type') {
                requestData.log_type = document.getElementById('clear-type').value;
            } else if (action === 'old') {
                requestData.days = 90;
            }
            
            try {
                const response = await fetch(`${API_BASE}clear.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                displayResult('result-clear', data, data.success ? 'success' : 'error');
            } catch (error) {
                displayResult('result-clear', { error: error.message }, 'error');
            }
        }
        
        console.log('‚úÖ API Tester initialized');
    </script>
</body>
</html>

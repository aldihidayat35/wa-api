<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Message | WhatsApp Multi-Session Dashboard</title>
    <link rel="shortcut icon" href="assets/media/logos/favicon.ico" />
    
    <!-- Metronic 8 Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
    
    <!-- Metronic 8 Global Plugins Bundle -->
    <link href="assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    
    <!-- Metronic 8 Global Styles Bundle -->
    <link href="assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
    
    <!-- Custom Styles for Send Message -->
    <style>
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            margin-top: 10px;
            border-radius: 8px;
            display: none;
        }
        .contact-chip {
            display: inline-block;
            padding: 5px 12px;
            margin: 3px;
            background: #e8f4f8;
            border-radius: 15px;
            font-size: 0.9rem;
        }
        .contact-chip .remove-chip {
            margin-left: 8px;
            cursor: pointer;
            color: #f1416c;
            font-weight: bold;
        }
        .progress-bar-custom {
            transition: width 0.3s ease;
        }
        .message-type-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .message-type-card:hover {
            border-color: #009ef7;
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,158,247,0.2);
        }
        .message-type-card.active {
            border-color: #009ef7;
            background: #f1faff;
        }
        .recipients-container {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e4e6ef;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body id="kt_app_body" data-kt-app-layout="dark-sidebar" data-kt-app-header-fixed="true" data-kt-app-sidebar-enabled="true" data-kt-app-sidebar-fixed="true" data-kt-app-sidebar-hoverable="true" data-kt-app-sidebar-push-header="true" data-kt-app-sidebar-push-toolbar="true" data-kt-app-sidebar-push-footer="true" data-kt-app-toolbar-enabled="true" class="app-default">
    
    <!--begin::App-->
    <div class="d-flex flex-column flex-root app-root" id="kt_app_root">
        <!--begin::Page-->
        <div class="app-page flex-column flex-column-fluid" id="kt_app_page">
            
            <!-- Header Component akan dimuat di sini -->
            <div id="header-container"></div>
            
            <!--begin::Wrapper - kt_app_wrapper-->
            <div class="app-wrapper flex-column flex-row-fluid" id="kt_app_wrapper">
                
                <!-- Sidebar Component akan dimuat di sini -->
                <div id="sidebar-container"></div>
                
                <!--begin::Main - kt_app_main-->
                <div class="app-main flex-column flex-row-fluid" id="kt_app_main">
                    <!--begin::Content wrapper-->
                    <div class="d-flex flex-column flex-column-fluid">
                        
                        <!--begin::Toolbar - kt_app_toolbar-->
                        <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
                            <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
                                <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                                    <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">üí¨ Send Message</h1>
                                    <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                                        <li class="breadcrumb-item text-muted"><a href="index.html" class="text-muted text-hover-primary">Home</a></li>
                                        <li class="breadcrumb-item"><span class="bullet bg-gray-400 w-5px h-2px"></span></li>
                                        <li class="breadcrumb-item text-muted">Send Message</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!--end::Toolbar-->
                        
                        <!--begin::Content - kt_app_content-->
                        <div id="kt_app_content" class="app-content flex-column-fluid">
                            <div id="kt_app_content_container" class="app-container container-xxl">
                                
                                <!-- Row 1: Session Selector -->
                                <div class="row g-5 mb-5">
                                    <div class="col-12">
                                        <div class="card card-flush">
                                            <div class="card-body py-5">
                                                <div class="row align-items-center">
                                                    <div class="col-md-6">
                                                        <label class="form-label fw-bold fs-6">Select Session to Send From</label>
                                                        <select id="session-selector" class="form-select form-select-lg form-select-solid">
                                                            <option value="">Loading sessions...</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="d-flex align-items-center mt-5 mt-md-0">
                                                            <div class="symbol symbol-50px me-5">
                                                                <span class="symbol-label bg-light-primary">
                                                                    <span class="svg-icon svg-icon-2x svg-icon-primary">
                                                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                            <path opacity="0.3" d="M22 12C22 17.5 17.5 22 12 22C6.5 22 2 17.5 2 12C2 6.5 6.5 2 12 2C17.5 2 22 6.5 22 12ZM12 7C10.3 7 9 8.3 9 10C9 11.7 10.3 13 12 13C13.7 13 15 11.7 15 10C15 8.3 13.7 7 12 7Z" fill="currentColor"/>
                                                                            <path d="M12 22C14.6 22 17 21 18.7 19.4C17.9 16.9 15.2 15 12 15C8.8 15 6.09999 16.9 5.29999 19.4C6.99999 21 9.4 22 12 22Z" fill="currentColor"/>
                                                                        </svg>
                                                                    </span>
                                                                </span>
                                                            </div>
                                                            <div class="d-flex flex-column">
                                                                <span class="text-gray-800 fw-bold fs-6" id="session-user-name">-</span>
                                                                <span class="text-muted fw-semibold" id="session-user-number">Select a session</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Row 2: Message Type Selection -->
                                <div class="row g-5 mb-5">
                                    <div class="col-12">
                                        <div class="card card-flush">
                                            <div class="card-header">
                                                <h3 class="card-title fw-bold">Select Message Type</h3>
                                            </div>
                                            <div class="card-body">
                                                <div class="row g-5">
                                                    <div class="col-md-3">
                                                        <div class="message-type-card card card-bordered h-100 active" data-type="text-single">
                                                            <div class="card-body text-center p-5">
                                                                <span class="svg-icon svg-icon-3x svg-icon-primary mb-3">
                                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                        <path opacity="0.3" d="M20 3H4C2.89543 3 2 3.89543 2 5V16C2 17.1046 2.89543 18 4 18H4.5C5.05228 18 5.5 18.4477 5.5 19V21.5052C5.5 22.1441 6.21212 22.5253 6.74376 22.1708L11.4885 19.0077C12.4741 18.3506 13.6321 18 14.8167 18H20C21.1046 18 22 17.1046 22 16V5C22 3.89543 21.1046 3 20 3Z" fill="currentColor"/>
                                                                        <rect x="6" y="12" width="7" height="2" rx="1" fill="currentColor"/>
                                                                        <rect x="6" y="7" width="12" height="2" rx="1" fill="currentColor"/>
                                                                    </svg>
                                                                </span>
                                                                <h4 class="fw-bold mb-2">Text Single</h4>
                                                                <p class="text-muted fs-7 mb-0">Send text to one contact</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="message-type-card card card-bordered h-100" data-type="text-bulk">
                                                            <div class="card-body text-center p-5">
                                                                <span class="svg-icon svg-icon-3x svg-icon-success mb-3">
                                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                        <path opacity="0.3" d="M21.25 18.525L13.05 21.825C12.35 22.125 11.65 22.125 10.95 21.825L2.75 18.525C1.75 18.125 1.75 16.725 2.75 16.325L4.04999 15.825L10.25 18.325C10.85 18.525 11.45 18.625 12.05 18.625C12.65 18.625 13.25 18.525 13.85 18.325L20.05 15.825L21.35 16.325C22.35 16.725 22.35 18.125 21.25 18.525Z" fill="currentColor"/>
                                                                        <path d="M11.05 11.025L2.84998 7.725C1.84998 7.325 1.84998 5.925 2.84998 5.525L11.05 2.225C11.75 1.925 12.45 1.925 13.15 2.225L21.35 5.525C22.35 5.925 22.35 7.325 21.35 7.725L13.05 11.025C12.45 11.325 11.65 11.325 11.05 11.025Z" fill="currentColor"/>
                                                                    </svg>
                                                                </span>
                                                                <h4 class="fw-bold mb-2">Text Bulk</h4>
                                                                <p class="text-muted fs-7 mb-0">Send text to multiple contacts</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="message-type-card card card-bordered h-100" data-type="image-single">
                                                            <div class="card-body text-center p-5">
                                                                <span class="svg-icon svg-icon-3x svg-icon-warning mb-3">
                                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                        <path opacity="0.3" d="M22 5V19C22 19.6 21.6 20 21 20H19.5L11.9 12.4C11.5 12 10.9 12 10.5 12.4L3 20C2.5 20 2 19.5 2 19V5C2 4.4 2.4 4 3 4H21C21.6 4 22 4.4 22 5ZM7.5 7C6.7 7 6 7.7 6 8.5C6 9.3 6.7 10 7.5 10C8.3 10 9 9.3 9 8.5C9 7.7 8.3 7 7.5 7Z" fill="currentColor"/>
                                                                        <path d="M19.1 10C18.7 9.60001 18.1 9.60001 17.7 10L10.7 17H2V19C2 19.6 2.4 20 3 20H21C21.6 20 22 19.6 22 19V12.9L19.1 10Z" fill="currentColor"/>
                                                                    </svg>
                                                                </span>
                                                                <h4 class="fw-bold mb-2">Image Single</h4>
                                                                <p class="text-muted fs-7 mb-0">Send image to one contact</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="message-type-card card card-bordered h-100" data-type="image-bulk">
                                                            <div class="card-body text-center p-5">
                                                                <span class="svg-icon svg-icon-3x svg-icon-danger mb-3">
                                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                        <path d="M16.0077 19.2901L12.9293 17.5311C12.3487 17.1993 11.6407 17.1796 11.0426 17.4787L6.89443 19.5528C5.56462 20.2177 4 19.2507 4 17.7639V5C4 3.89543 4.89543 3 6 3H17C18.1046 3 19 3.89543 19 5V17.5536C19 19.0893 17.341 20.052 16.0077 19.2901Z" fill="currentColor"/>
                                                                    </svg>
                                                                </span>
                                                                <h4 class="fw-bold mb-2">Image Bulk</h4>
                                                                <p class="text-muted fs-7 mb-0">Send image to multiple contacts</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Row 3: Message Form -->
                                <div class="row g-5 mb-5">
                                    <!-- Left Column: Recipients -->
                                    <div class="col-lg-5">
                                        <div class="card card-flush h-100">
                                            <div class="card-header">
                                                <h3 class="card-title fw-bold">üìû Recipients</h3>
                                            </div>
                                            <div class="card-body">
                                                <!-- Single Recipient (for single mode) -->
                                                <div id="single-recipient-section">
                                                    <label class="form-label fw-semibold">Phone Number</label>
                                                    <input type="text" id="single-phone" class="form-control form-control-solid form-control-lg mb-3" placeholder="e.g., 628123456789" />
                                                    <div class="form-text mb-5">Include country code without + or @s.whatsapp.net</div>
                                                </div>
                                                
                                                <!-- Bulk Recipients (for bulk mode) -->
                                                <div id="bulk-recipient-section" style="display: none;">
                                                    <ul class="nav nav-tabs nav-line-tabs mb-5 fs-6">
                                                        <li class="nav-item">
                                                            <a class="nav-link active" data-bs-toggle="tab" href="#manual-tab">‚úçÔ∏è Manual</a>
                                                        </li>
                                                        <li class="nav-item">
                                                            <a class="nav-link" data-bs-toggle="tab" href="#database-tab">üóÑÔ∏è From Database</a>
                                                        </li>
                                                    </ul>
                                                    
                                                    <div class="tab-content">
                                                        <!-- Manual Input Tab -->
                                                        <div class="tab-pane fade show active" id="manual-tab">
                                                            <label class="form-label fw-semibold">Add Phone Numbers</label>
                                                            <div class="input-group mb-3">
                                                                <input type="text" id="bulk-phone-input" class="form-control form-control-solid" placeholder="628123456789" />
                                                                <button class="btn btn-primary" id="add-phone-btn">
                                                                    <i class="bi bi-plus-lg"></i> Add
                                                                </button>
                                                            </div>
                                                            <div class="form-text mb-3">Or paste multiple numbers (one per line)</div>
                                                            <textarea id="bulk-phones-textarea" class="form-control form-control-solid mb-3" rows="4" placeholder="628123456789&#10;628987654321&#10;628555666777"></textarea>
                                                            <button class="btn btn-sm btn-light-primary w-100" id="import-phones-btn">
                                                                <i class="bi bi-upload"></i> Import Numbers
                                                            </button>
                                                        </div>
                                                        
                                                        <!-- Database Tab -->
                                                        <div class="tab-pane fade" id="database-tab">
                                                            <div class="alert alert-info d-flex align-items-center p-5">
                                                                <span class="svg-icon svg-icon-2hx svg-icon-info me-4">
                                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                        <path opacity="0.3" d="M20.5543 4.37824L12.1798 2.02473C12.0626 1.99176 11.9376 1.99176 11.8203 2.02473L3.44572 4.37824C3.18118 4.45258 3 4.6807 3 4.93945V13.569C3 14.6914 3.48509 15.8404 4.4417 16.984C5.17231 17.8575 6.18314 18.7345 7.446 19.5909C9.56752 21.0295 11.6566 21.912 11.7445 21.9488C11.8258 21.9829 11.9129 22 12.0001 22C12.0872 22 12.1744 21.983 12.2557 21.9488C12.3435 21.912 14.4326 21.0295 16.5541 19.5909C17.8169 18.7345 18.8277 17.8575 19.5584 16.984C20.515 15.8404 21 14.6914 21 13.569V4.93945C21 4.6807 20.8189 4.45258 20.5543 4.37824Z" fill="currentColor"/>
                                                                        <path d="M10.5606 11.3042L9.57283 10.3018C9.28174 10.0065 8.80522 10.0065 8.51412 10.3018C8.22897 10.5912 8.22897 11.0559 8.51412 11.3452L10.4182 13.2773C10.8099 13.6747 11.451 13.6747 11.8427 13.2773L15.4859 9.58051C15.771 9.29117 15.771 8.82648 15.4859 8.53714C15.1948 8.24176 14.7183 8.24176 14.4272 8.53714L11.7002 11.3042C11.3869 11.6221 10.874 11.6221 10.5606 11.3042Z" fill="currentColor"/>
                                                                    </svg>
                                                                </span>
                                                                <div class="d-flex flex-column">
                                                                    <h5 class="mb-1">Database Integration</h5>
                                                                    <span>Feature coming soon. You'll be able to select contacts from your database.</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Recipients List -->
                                                    <div class="separator my-5"></div>
                                                    <label class="form-label fw-semibold">Selected Recipients (<span id="recipients-count">0</span>)</label>
                                                    <div class="recipients-container" id="recipients-list">
                                                        <span class="text-muted fs-7">No recipients added yet</span>
                                                    </div>
                                                    <button class="btn btn-sm btn-light-danger w-100 mt-3" id="clear-recipients-btn">
                                                        <i class="bi bi-trash"></i> Clear All
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Right Column: Message Content -->
                                    <div class="col-lg-7">
                                        <div class="card card-flush h-100">
                                            <div class="card-header">
                                                <h3 class="card-title fw-bold">‚úâÔ∏è Message Content</h3>
                                            </div>
                                            <div class="card-body">
                                                <!-- Image Upload Section -->
                                                <div id="image-upload-section" style="display: none;">
                                                    <label class="form-label fw-semibold">Upload Image</label>
                                                    <input type="file" class="form-control form-control-solid mb-3" id="image-input" accept="image/*" />
                                                    <img id="image-preview" class="image-preview" alt="Preview" />
                                                    <div class="separator my-5"></div>
                                                </div>
                                                
                                                <!-- Message Text -->
                                                <label class="form-label fw-semibold">Message Text <span id="caption-label" style="display: none;">(Caption)</span></label>
                                                <textarea id="message-text" class="form-control form-control-solid mb-5" rows="8" placeholder="Type your message here..."></textarea>
                                                
                                                <!-- Variables Helper -->
                                                <div class="alert alert-light-primary d-flex align-items-center p-3 mb-5">
                                                    <span class="svg-icon svg-icon-2x svg-icon-primary me-3">
                                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                            <path opacity="0.3" d="M22 12C22 17.5 17.5 22 12 22C6.5 22 2 17.5 2 12C2 6.5 6.5 2 12 2C17.5 2 22 6.5 22 12ZM12 7C10.3 7 9 8.3 9 10C9 11.7 10.3 13 12 13C13.7 13 15 11.7 15 10C15 8.3 13.7 7 12 7Z" fill="currentColor"/>
                                                        </svg>
                                                    </span>
                                                    <div class="d-flex flex-column">
                                                        <span class="fs-7"><strong>Pro Tip:</strong> Use <code>{name}</code> for personalization (bulk only)</span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Delay Settings (Bulk Only) -->
                                                <div id="delay-section" style="display: none;">
                                                    <div class="separator my-5"></div>
                                                    <label class="form-label fw-semibold">‚è±Ô∏è Delay Between Messages</label>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label fs-7">Minimum Delay (seconds)</label>
                                                            <input type="number" id="delay-min" class="form-control form-control-solid" value="2" min="1" max="60" />
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label fs-7">Maximum Delay (seconds)</label>
                                                            <input type="number" id="delay-max" class="form-control form-control-solid" value="5" min="1" max="60" />
                                                        </div>
                                                    </div>
                                                    <div class="form-text mt-2">Random delay helps prevent spam detection</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Row 4: Send Button & Progress -->
                                <div class="row g-5">
                                    <div class="col-12">
                                        <div class="card card-flush">
                                            <div class="card-body">
                                                <button id="send-message-btn" class="btn btn-lg btn-primary w-100 mb-5" disabled>
                                                    <span class="svg-icon svg-icon-2">
                                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                            <path d="M15.43 8.56949L10.744 15.1395C10.6422 15.282 10.5804 15.4492 10.5651 15.6236C10.5498 15.7981 10.5815 15.9734 10.657 16.1315L13.194 21.4425C13.2737 21.6097 13.3991 21.751 13.5557 21.8499C13.7123 21.9488 13.8938 22.0014 14.079 22.0015H14.117C14.3087 21.9941 14.4941 21.9307 14.6502 21.8191C14.8062 21.7075 14.9261 21.5526 14.995 21.3735L21.933 3.33649C22.0011 3.15918 22.0164 2.96594 21.977 2.78013C21.9376 2.59432 21.8452 2.4239 21.711 2.28949L15.43 8.56949Z" fill="currentColor"/>
                                                            <path opacity="0.3" d="M20.664 2.06648L2.62602 9.00148C2.44768 9.07085 2.29348 9.19082 2.1824 9.34663C2.07131 9.50244 2.00818 9.68731 2.00074 9.87853C1.99331 10.0697 2.04189 10.259 2.14054 10.4229C2.23919 10.5869 2.38359 10.7185 2.55601 10.8015L7.86601 13.3365C8.02383 13.4126 8.19925 13.4448 8.37382 13.4297C8.54839 13.4145 8.71565 13.3526 8.85801 13.2505L15.43 8.56548L21.711 2.28448C21.5762 2.15096 21.4055 2.05932 21.2198 2.02064C21.034 1.98196 20.8409 1.99788 20.664 2.06648Z" fill="currentColor"/>
                                                        </svg>
                                                    </span>
                                                    Send Message
                                                </button>
                                                
                                                <!-- Progress Bar (for bulk sending) -->
                                                <div id="progress-section" style="display: none;">
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span class="fw-semibold">Sending Progress</span>
                                                        <span class="fw-bold" id="progress-text">0 / 0</span>
                                                    </div>
                                                    <div class="progress h-20px">
                                                        <div id="progress-bar" class="progress-bar progress-bar-custom bg-primary" role="progressbar" style="width: 0%"></div>
                                                    </div>
                                                    <div class="mt-3" id="progress-logs" style="max-height: 200px; overflow-y: auto;"></div>
                                                </div>
                                                
                                                <!-- Status Alert -->
                                                <div id="status-alert" class="alert mt-5" style="display: none;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                            <!--end::Content container-->
                        </div>
                        <!--end::Content-->
                        
                    </div>
                    <!--end::Content wrapper-->
                    
                    <!-- Footer Component akan dimuat di sini -->
                    <div id="footer-container"></div>
                    
                </div>
                <!--end::Main-->
                
            </div>
            <!--end::Wrapper-->
            
        </div>
        <!--end::Page-->
    </div>
    <!--end::App-->
    
    <!-- Metronic 8 Global Javascript Bundle -->
    <script src="assets/plugins/global/plugins.bundle.js"></script>
    <script src="assets/js/scripts.bundle.js"></script>
    
    <!-- Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- Send Message Logic -->
    <script src="send-message.js"></script>
    
</body>
</html>

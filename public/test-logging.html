<!DOCTYPE html>
<html>
<head>
    <title>Test Logging Only</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            background: #f4f4f4;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #4CAF50;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            border-left-color: #f44336;
            color: #d32f2f;
        }
        h1 {
            color: #333;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Logging Function</h1>
    <p>Test apakah fungsi logging bekerja tanpa perlu kirim pesan WhatsApp</p>
    
    <button onclick="testLogMessage()">Test Log Message</button>
    <button onclick="testLogError()">Test Log Error</button>
    <button onclick="testLogSession()">Test Log Session</button>
    <button onclick="testLogSystem()">Test Log System</button>
    <button onclick="viewConsole()">Open Console (F12)</button>
    
    <div id="result"></div>
    
    <h2>Console Output:</h2>
    <div id="console-output" class="result"></div>

    <script>
        const consoleDiv = document.getElementById('console-output');
        const resultDiv = document.getElementById('result');
        
        // Override console untuk tampilkan di page
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole('LOG: ' + args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('ERROR: ' + args.join(' '), true);
        };
        
        function addToConsole(message, isError = false) {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.textContent = `[${time}] ${message}`;
            if (isError) div.style.color = '#d32f2f';
            consoleDiv.appendChild(div);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function displayResult(message, isError = false) {
            resultDiv.className = 'result' + (isError ? ' error' : '');
            resultDiv.textContent = message;
        }
        
        // Log Activity Function (sama seperti di send-message.js)
        async function logActivity(type, title, description, metadata = {}) {
            console.log('üìù Logging activity:', title);
            
            const requestData = {
                log_type: type,
                title: title,
                description: description,
                session_id: metadata.sessionId || null,
                phone_number: metadata.recipient || metadata.sender || null,
                metadata: metadata
            };
            
            console.log('üì¶ Activity data:', JSON.stringify(requestData, null, 2));
            console.log('üåê API URL:', '../api/logs/create.php');
            
            try {
                const response = await fetch('../api/logs/create.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                console.log('üì° Response status:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå HTTP Error:', response.status, errorText.substring(0, 200));
                    displayResult(`HTTP Error ${response.status}: ${errorText.substring(0, 100)}`, true);
                    return;
                }
                
                const data = await response.json();
                console.log('üì• Response data:', JSON.stringify(data, null, 2));
                
                if (data.success) {
                    console.log('‚úÖ Activity logged successfully! ID:', data.data?.id);
                    displayResult(`‚úÖ Success! Log ID: ${data.data?.id}\n\n${JSON.stringify(data, null, 2)}`);
                } else {
                    console.error('‚ùå API returned error:', data.message, data.errors);
                    displayResult(`‚ùå API Error: ${data.message}\n\n${JSON.stringify(data, null, 2)}`, true);
                }
            } catch (error) {
                console.error('‚ùå Error logging activity:', error.message);
                console.error('Stack:', error.stack);
                displayResult(`‚ùå Exception: ${error.message}\n\nStack: ${error.stack}`, true);
            }
        }
        
        // Test Functions
        async function testLogMessage() {
            console.log('=== Testing Message Log ===');
            await logActivity('message', 'Test Pesan Terkirim', 'Testing message log dari test page', {
                sessionId: 'test_session',
                recipient: '628123456789',
                messageType: 'text'
            });
        }
        
        async function testLogError() {
            console.log('=== Testing Error Log ===');
            await logActivity('error', 'Test Error', 'Testing error log dari test page', {
                sessionId: 'test_session',
                errorMessage: 'Sample error message'
            });
        }
        
        async function testLogSession() {
            console.log('=== Testing Session Log ===');
            await logActivity('session', 'Test Session Connected', 'Testing session log dari test page', {
                sessionId: 'test_session',
                status: 'connected'
            });
        }
        
        async function testLogSystem() {
            console.log('=== Testing System Log ===');
            await logActivity('system', 'Test System Event', 'Testing system log dari test page', {
                eventType: 'test'
            });
        }
        
        function viewConsole() {
            alert('Press F12 to open browser DevTools Console');
        }
        
        console.log('Test page loaded. Click buttons to test logging!');
    </script>
</body>
</html>
